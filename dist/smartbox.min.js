!function(a){var b=(a.document,!1),c=[],d={config:{defaultPlatform:"browser",currentPlatform:""},isInited:function(){return b},ready:function(a){c.push(a)},readyForPlatform:function(a,b){var c=this;this.ready(function(){a==c.currentPlatform.name&&b()})},_onReady:function(){for(var a=0,b=c.length;b>a;a++)c[a].call(this)},initialise:function(){var c=this,e=this.utils;b||(a.$$log=e.log.log,a.$$error=e.error,d.platforms.initialise(function(a){c.currentPlatform=a,b=!0,setTimeout(function(){c._onReady()})}))}};d.utils={error:function(a){$$log(a,"error")},log:{log:$.noop,state:$.noop,show:$.noop,hide:$.noop,startProfile:$.noop,stopProfile:$.noop},legend:{}},$(function(){d.initialise()}),a.SB=d}(this),!function(){var a,b,c,d={},e=null,f=null;a={addPlatform:function(a){a.name===SB.config.defaultPlatform?f=a:d[a.name]=a},getCurrentPlatform:function(){return e},initialise:function(a){var b=((new Date).getTime(),_.find(d,function(a){return a.detect()}));b=b||f,b?b.addExternalFiles(function(){b.setPlugins(),b.refreshKeys(),b.initialise(),e=b,a&&a.call(this,b)}):$$error("No Platform detected!")}},b=function(a){this.name=a;var b={};this.refreshKeys=function(){b={};for(var a in this.keys)b[this.keys[a]]=a.toLowerCase()},this.getKeyByKeyCode=function(a){return b[a]},SB.platforms.addPlatform(this)},c={externalCss:[],externalJs:[],keys:{},DUID:"",detect:function(){return!1},initialise:function(){},getDUID:function(){return""},getRandomDUID:function(){return(new Date).getTime().toString(16)+Math.floor(Math.random()*parseInt("10000",16)).toString(16)},getNativeDUID:function(){return""},setPlugins:function(){},volumeUp:function(){},volumeDown:function(){},getVolume:function(){},setData:function(){},getData:function(){},removeData:function(){},addExternalFiles:function(a){this.addExternalJS(this.externalJs,a),this.addExternalCss(this.externalCss)},addExternalJS:function(a,b){function c(){g++,g===h&&b&&b.call()}var d,e,f,g=0,h=a.length;if(a.length){d=document.createDocumentFragment(),e=document.createElement("script"),e.type="text/javascript",e.onload=c;for(var i=0;h>i;i++)f=e.cloneNode(),f.src=a[i],d.appendChild(f);document.body.appendChild(d)}else b&&b.call(this)},addExternalCss:function(a){var b;a.length&&(b=document.createDocumentFragment(),_.each(a,function(a){var c=document.createElement("link");c.rel="stylesheet",c.href=a,b.appendChild(c)}),document.body.appendChild(b))},exit:function(){}},_(b.prototype).extend(c),SB.platforms=a,SB.Platform=b}(this),function(a,b,c){function d(b){var d=a(c.createElement("div"));return d.html(b.template),d.find("."+b.elClass)}function e(){h=a(c.createElement("div")).attr("id","keyboard_overlay"),i=a(c.createElement("div")).attr({id:"keyboard_popup","class":"keyboard_popup_wrapper"}),h.append(i),a(c.body).append(h)}function f(b,c){this.$input=a(b),this.initialise(c),this.stopBlink(),this.setText(b.value)}var g,h,i,j,k="SBInput",l={keyboard:{type:"fulltext_ru",firstLayout:"ru"},formatText:null,bindKeyboard:null,input:{template:'<div class="smart_input-container"><div class="smart_input-wrap"><span class="smart_input-text"></span><span class="smart_input-cursor"></span></div></div>',elClass:"smart_input-container",wrapperClass:"smart_input-wrap",cursorClass:"smart_input-cursor",textClass:"smart_input-text"},directKeyboardInput:!0,max:0,next:null};g={isInited:!1,_generatedKeyboard:!1,isKeyboardActive:!1,text:"",initialise:function(b){var c;return this.isInited?this:(b=a.extend({},l,b),b.next=this.$input.attr("data-next")||b.next,b.max=this.$input.attr("data-max")||b.max||0,this.options=b,this.$input.attr({"data-value":"","data-max":b.max}),c=d(b.input),c.addClass(this.$input[0].className),this.$input.hide().after(c),this.$el=c,this.$text=c.find("."+b.input.textClass),this.$cursor=c.find("."+b.input.cursorClass),this.$wrapper=c.find("."+b.input.wrapperClass),b.directKeyboardInput&&this.addDirectKeyboardEvents(),this.addEvents(),this.isInited=!0,this)},startBlink:function(){var a=this,b=this.options.input.cursorClass+"_hidden";j&&clearInterval(j),j=setInterval(function(){a.$cursor.toggleClass(b)},500)},stopBlink:function(){var a=this.options.input.cursorClass+"_hidden";j&&clearInterval(j),this.$cursor.addClass(a)},addEvents:function(){var a=this.$wrapper,b=this.options,c=this;this.$input.on({change:function(){c.$text.html(this.value)},startBlink:function(){c.startBlink()},stopBlink:function(){c.stopBlink()},hideKeyboard:function(){a.hasClass("smart-input-active")&&c.hideKeyboard()},showKeyboard:function(){c.showKeyboard()}}),a.off("nav_focus nav_blur click"),b.bindKeyboard&&(b.keyboard=!1,b.bindKeyboard.off("type backspace delall").on("type",function(a){c.type(a.letter)}).on("backspace",function(){c.type("backspace")}).on("delall",function(){c.type("delall")})),b.keyboard&&this.$el.on("click",function(){c.startBlink(),c.showKeyboard()})},addDirectKeyboardEvents:function(){var b=this;this.$el.on({nav_focus:function(){b.startBlink(),a(c.body).on("keypress.SBInput",function(a){if(a.charCode)a.preventDefault(),b.type(String.fromCharCode(a.charCode));else switch(a.keyCode){case 8:a.preventDefault(),b.type("backspace")}})},nav_blur:function(){b.stopBlink(),a(c.body).off("keypress.SBInput")}})},setText:function(a){var b,c=this.options,d=c.max;a.length>d&&0!=d&&(a=a.substr(0,d)),c.formatText&&(a=c.formatText(a)),this.$input.val(a).change(),this.text=a,a.length>1?(b=this.$text.width()>this.$wrapper.width()?"add":"remove",this.$wrapper[b+"Class"]("."+c.input.wrapperClass+"_right")):this.$wrapper.removeClass("."+c.input.wrapperClass+"_right")},type:function(a){var b=this.text||"",c=this.options;switch(a){case"backspace":b=b.substr(0,b.length-1);break;case"delall":b="";break;default:b+=a}this.setText(b),b.length===c.max&&c.next&&0!=c.max&&(this.hideKeyboard(),$$nav.current(c.next),$$nav.current().click())},hideKeyboard:function(a){var b=this.$wrapper;b.removeClass("smart-input-active"),this.$input.trigger("keyboard_hide"),h&&h.hide(),$$nav.restore(),$$voice.restore(),this.isKeyboardActive=!1,this.$input.trigger(a?"keyboard_complete":"keyboard_cancel"),i&&i.trigger("keyboard_hide")},showKeyboard:function(){var a=this.$wrapper,b=this.options.keyboard,c=this;this.isKeyboardActive=!0,a.addClass("smart-input-active");var d=this.$el.outerHeight(),f=this.$el.offset(),g=f.top+d;h||e(),this._generatedKeyboard||(i.SBKeyboard(b),this._generatedKeyboard=!0),i.SBKeyboard("changeKeyboard",b.type).css({left:f.left,top:g}).off("type backspace delall complete cancel").on("type",function(a){c.type(a.letter)}).on("backspace",function(){c.type("backspace")}).on("delall",function(){c.type("delall")}).on("complete cancel",function(a){var b=!1;"complete"===a.type&&(b=!0),c.stopBlink(),c.hideKeyboard(b)}),h.show();var j=i.height(),k=i.width();g+j>680&&i.css({top:g-j-d}),f.left+k>1280&&i.css({left:1280-k-20}),$$voice.save(),$$nav.save(),$$nav.on("#keyboard_popup"),i.SBKeyboard("refreshVoice").voiceLink(),this.$el.addClass($$nav.higlight_class),this.$input.trigger("keyboard_show"),this.startBlink()}},a.extend(f.prototype,g),g=null,a.fn.SBInput=function(){var b=Array.prototype.slice.call(arguments),c="string"==typeof b[0]&&b[0],d="object"==typeof b[0]&&b[0],e=b.slice(1);return this.each(function(){var b=a.data(this,"plugin_"+k);b?"function"==typeof b[c]&&b[c](e):a.data(this,"plugin_"+k,new f(this,d))})}}(jQuery,window,document),function(a,b,c){function d(a,b){this.type=a.type,this.currentLayout="",this.previousLayout="",this.$el=b,this.$layouts={},this.presets=[],this.initialize(a)}function e(b,c){this.$el=a(b),this.keyboards={},c=a.extend({},h,c),this.addKeyboard(c),this.$el.addClass("keyboard_popup_wrapper"),this.currentKeyboard=this.keyboards[c.type],this.currentKeyboard.show()}var f="SBKeyboard",g=/([^{]+){{([^}]*)}}/,h={type:"en",firstLayout:"en"},i={},j={},k={};j={isShiftActive:!1,isNumsShown:!1,initialize:function(b){var d,e,f="",g=!1;d=SB.keyboardPresets[this.type],this.$wrap=a(c.createElement("div")).addClass("kb-wrap"),"function"==typeof d?(this.presets.push(this.type),f=this.generateBoard(this.type)):d.length&&(this.presets=d,g=-1!==d.indexOf("fullnum"),f=this.generateFull(this.presets,g)),this.$wrap.append(f).addClass("kekekey_"+this.type),this.$el.append(this.$wrap),this.setEvents();for(var h=0;h<this.presets.length;h++)e=this.presets[h],this.$layouts[e]=this.$wrap.find(".keyboard_generated_"+e);g&&(this.presets=_.without(this.presets,"fullnum")),this.changeLayout(-1!==this.presets.indexOf(b.firstLayout)?b.firstLayout:this.presets[0])},generateFull:function(a,b){var c="",d="";a.length>1&&this.$wrap.addClass("kb-multilang"),b&&this.$wrap.addClass("kb-havenums");for(var e=0;e<a.length;e++)d=a[e],c+=this.generateBoard(d);return c},generateBoard:function(a){var b,c,d=SB.keyboardPresets[a],e="",f="",h={};if(k[a])return k[a].board;d=d(),e='<div class="kb-c keyboard_generated_'+a+'">';for(var i=0;i<d.length;i++){b=d[i],f='<div class="kb-row" data-nav_type="hbox">';for(var j=0;j<b.length;j++){if(c=b[j],1==c.length||"&amp;"===c)h={text:c,type:"",letter:c};else{var l=g.exec(c);h.text=l[2]||"",h.type=l[1],h.letter=""}f+='<div class="kbtn nav-item '+h.type+'" data-letter="'+_.escape(h.letter)+'"',h.type&&(f+=' data-keytype="'+h.type+'"'),f+=">"+h.text+"</div>"}e+=f+"</div>"}return e+="</div>",k[a]={board:e},e},onKeyNum:function(b){switch(b.keyName){case"red":this.$el.trigger("backspace");break;default:var c=a.Event({type:"type"});c.letter=""+b.num,this.$el.trigger(c)}b.stopPropagation()},defaultOnKey:function(a){a.stopPropagation()},onKeyDown:function(b){var c,d=a(b.currentTarget),e=d.attr("data-keytype"),f=d.attr("data-letter");if(c=a.Event({type:"type"}),e)switch(e){case"backspace":c="backspace";break;case"delall":c="delall";break;case"complete":c="complete";break;case"space":c.letter=" ";break;case"shift":return void this.triggerShiftLetters();case"lang":return void this.changeKeyboardLang();case"nums":return void this.triggerNumKeyboard()}else c.letter=this.isShiftActive?f.toUpperCase():f;c&&this.$el.trigger(c),b.stopPropagation()},triggerShiftLetters:function(){this.isShiftActive?(this.isShiftActive=!1,this.$el.removeClass("shift_active")):(this.isShiftActive=!0,this.$el.addClass("shift_active"))},triggerNumKeyboard:function(){this.isNumsShown?(this.isNumsShown=!1,this.changeLayout(this.previousLayout),this.$el.trigger("hide_num")):(this.isNumsShown=!0,this.changeLayout("fullnum"),this.$el.trigger("show_num")),$$nav.current(this.$layouts[this.currentLayout].find(".nums"))},changeKeyboardLang:function(){var a,b=this.presets.indexOf(this.currentLayout);a=(b+1)%this.presets.length,this.changeLayout(this.presets[a]),$$nav.current(this.$layouts[this.currentLayout].find(".lang"))},changeLayout:function(a){var b,c=this.$layouts[a];this.currentLayout&&(b=this.$layouts[this.currentLayout],b&&b.hide(),this.$el.removeClass("keyboard_"+this.currentLayout),this.previousLayout=this.currentLayout),c&&(this.currentLayout=a,this.$el.addClass("keyboard_"+a),c.show())},setEvents:function(){var a=this;this.$wrap.on("nav_key:yellow nav_key:blue",this.defaultOnKey),this.$wrap.on("nav_key:num nav_key:red",_.bind(this.onKeyNum,this)),this.$wrap.on("click",".kbtn",_.bind(this.onKeyDown,this)),this.$wrap.on("nav_key:green",function(b){a.$el.trigger("complete"),b.stopPropagation()}).on("nav_key:return",function(b){a.$el.trigger("cancel"),b.stopPropagation()})},show:function(){return this.$wrap.show(),this.$el.addClass(this.type+"_wrap").addClass("keyboard_"+this.currentLayout),this},hide:function(){this.$wrap.hide(),this.$el.removeClass(this.type+"_wrap").removeClass("keyboard_"+this.currentLayout)}},a.extend(d.prototype,j),j=null,i={addKeyboard:function(b){var c=a.extend({},h,b);this.keyboards[c.type]=new d(c,this.$el)},changeKeyboard:function(a){this.keyboards[a]&&(this.currentKeyboard.hide(),this.currentKeyboard=this.keyboards[a].show())}},a.extend(e.prototype,i),i=null,a.fn.SBKeyboard=function(){var b=Array.prototype.slice.call(arguments),c="string"==typeof b[0]&&b[0],d="object"==typeof b[0]&&b[0],g=b.slice(1);return this.each(function(){var b=a.data(this,"plugin_"+f);b?c?b[c]&&b[c](g):d&&b.addKeyboard(d):a.data(this,"plugin_"+f,new e(this,d))})}}(jQuery,window,document),window.SB=window.SB||{},window.SB.keyboardPresets={en:function(){return["qwertyuiop".split(""),"asdfghjkl".split("").concat(['backspace{{<i class="backspace_icon"></i>}}']),['shift{{<i class="shift_icon"></i>Shift}}'].concat("zxcvbnm".split("")).concat(["delall{{<span>Del<br/>all</span>}}"]),["lang{{en}}","nums{{123}}","space{{}}","complete{{Complete}}"]]},ru:function(){return["йцукенгшщзхъ".split(""),"фывапролджэ".split("").concat(['backspace{{<i class="backspace_icon"></i>}}']),['shift{{<i class="shift_icon"></i>Shift}}'].concat("ячсмитьбю".split("")).concat(["delall{{<span>Del<br/>all</span>}}"]),["lang{{ru}}","nums{{123}}","space{{}}","complete{{Готово}}"]]},email:function(){return["1234567890@".split(""),"qwertyuiop".split("").concat(['backspace{{<i class="backspace_icon"></i>}}']),"asdfghjkl_".split("").concat(["delall{{<span>Del<br/>all</span>}}"]),"zxcvbnm-.".split("").concat("complete{{OK}}")]},num:function(){return["123".split(""),"456".split(""),"789".split(""),['backspace{{<i class="backspace_icon"></i>}}',"0","complete{{OK}}"]]},fullnum:function(){return["1234567890".split(""),'-/:;()$"'.split("").concat(["&amp;",'backspace{{<i class="backspace_icon"></i>}}']),["nums{{ABC}}"].concat("@.,?!'+".split("")),["space{{}}","complete{{OK}}"]]},fulltext_ru:["en","ru"],fulltext_ru_nums:["en","ru","fullnum"]},function(a){"use strict";function b(a){return-1===i.indexOf(a)}function c(a){var c=b(a)?" legend-clickable":"";return'<div class="legend-item legend-item-'+a+c+'" data-key="'+a+'"><i class="leg-icon leg-icon-'+a+'"></i><span class="legend-item-title"></span></div>'}function d(){for(var a,b,d="",e=0,f=h.length;f>e;e++)d+=c(h[e]);return a=document.createElement("div"),b=document.createElement("div"),a.className="legend",a.id="legend",b.className="legend-wrap",b.innerHTML=d,a.appendChild(b),a}var e,f,g,h=["info","red","green","yellow","blue","rew","play","pause","stop","ff","tools","left","right","up","down","leftright","updown","move","number","enter","ret"],i=["leftright","left","right","up","down","updown","move","number"],j=[];g={keys:{},init:function(){var a;if(!e){a=d(),this.$el=$(a);for(var b=0;b<h.length;b++)this.initKey(h[b]);e=!0}return this},initKey:function(a){var b;this.keys[a]||(b=this.$el.find(".legend-item-"+a),this.keys[a]=new f(b))},show:function(){this.$el.show()},hide:function(){this.$el.hide()},clear:function(){for(var a in this.keys)this.keys[a]("")},save:function(){for(var a in this.keys)j[a]=this.keys[a]()},restore:function(){_.each(h,function(a){g[a](j[a])});for(var a in j)this.keys[a](j[a]);j=[]}},f=function(a){return this.$el=a,this.$text=a.find(".legend-item-title"),_.bind(this.setText,this)},f.prototype.text="",f.prototype.isShown=!1,f.prototype.setText=function(a){return"undefined"==typeof a?this.text:void(a!==this.text&&(a=a||"",!a&&this.isShown?(this.$el.hide(),this.isShown=!1):a&&!this.isShown&&(this.$el.show(),this.isShown=!0),this.text=a,this.$text.html(a)))},a.$$legend=g.init(),$(function(){g.$el.appendTo(document.body),g.$el.on("click",".legend-clickable",function(){var a,b,c=$(this).attr("data-key");"ret"===c?c="return":"rew"===c&&(c="rw"),a=$.Event("nav_key:"+c),b=$.Event("nav_key"),b.keyName=a.keyName=c,$$nav.current().trigger(a).trigger(b)})})}(this),function(a){var b,c,d,e,f={},g={},h=[],i=0,j=20;b=$("<div></div>",{id:"log"}),$(function(){b.appendTo(document.body)}),c=$("<div></div>",{"class":"log-row"}),e=function(a){this.name=a,this.logs=0,this.states={};var b=$("#log_"+this.name);this.$content=b.find(".log_content"),this.$state=b.find(".log_states"),b=null},_.extend(e.prototype,{log:function(a){var b,d,e=c.clone();this.logs++,a=_.escape(a),e.html(a).appendTo(this.$content),this.logs>j&&(b=this.$content.find(".log-row"),d=b.length,b.slice(0,d-j).remove(),this.logs=b.length)},state:function l(a,b){var l=this.states[b]||this.createState(b);l.textContent=b+": "+a},createState:function(a){var b=document.createElement("div");return b.id="#log_"+this.name+"_"+a,this.states[a]=b,this.$state.append(b),b}});var k=_.template('<div class="log_pane" id="log_<%= name %>"><div class="log_name">Log: <%=name%></div><div class="log_content_wrap"><div class="log_content"></div></div><div class="log_states"></div></div>');d={create:function(a){return b.append(k({name:a})),g[a]=new e(a),h.push(a),g[a]},getPanel:function(a){return a=a||"default",g[a]||this.create(a)}},a.SB.utils.log={log:function(a,b){d.getPanel(b).log(a)},state:function(a,b,c){d.getPanel(c).state(a,b)},show:function(a){a=a||h[i],a?(i++,b.show(),$(".log_pane").hide(),$("#log_"+a).show()):(i=0,this.hide())},hide:function(){b.hide()},startProfile:function(a){a&&(f[a]=(new Date).getTime())},stopProfile:function(a){f[a]&&(this.log(a+": "+((new Date).getTime()-f[a])+"ms","profiler"),delete f[a])}}}(this),$(function(){$(document.body).on("nav_key:tools",function(){SB.utils.log.show()})}),!function(a,b){function c(){function a(a){var b,d={},e=a.keyCode;!m&&j&&(b=SB.currentPlatform.getKeyByKeyCode(e),l.indexOf(b)>-1?f(b):(k.indexOf(b)>-1&&(d.num=b[1],b="num"),c(b,d)))}function c(a,b){var c,d;j&&(c=$.Event("nav_key:"+a,b||{}),d=$.Event("nav_key"),c.keyName=a,d.keyName=a,j.trigger(c),j&&j.trigger(d))}function f(a){var b=i[a];b||(b=i[a]=_.throttle(function(){c(a)},800,{leading:!0})),b(a)}function g(){j&&j.click()}var h=[],i={},j=null,k=["n0","n1","n2","n3","n4","n5","n6","n7","n8","n9"],l=["green","red","yellow","red"],m=0;return{area_selector:".nav-item",higlight_class:"focus",$container:null,loopType:null,phantom_selector:"[data-nav-phantom]",isPaused:function(){return!!m},pause:function(){return m++,this},resume:function(a){return m--,(0>m||a)&&(m=0),this},save:function(){return h.push({navCur:j,area_selector:this.area_selector,higlight_class:this.higlight_class,$container:this.$container}),this},restore:function(){if(h.length){this.off();var a=h.pop();this.area_selector=a.area_selector,this.higlight_class=a.higlight_class,this.on(a.$container,a.navCur)}return this},current:function(a,b){if(!a)return j;b=b||"nav_key";var c=$(a);if(c.is(this.phantom_selector)&&(c=$($(c.attr("data-nav-phantom"))[0])),c.length>1)throw new Error("Focused element must be only one!");if(!c.length)return this;var d=j;return j&&j.removeClass(this.higlight_class).trigger("nav_blur",[b,c]),j=c,c.addClass(this.higlight_class).trigger("nav_focus",[b,d]),this},on:function(b,c){var d,f=this;return e=e||$(document.body),this.off(),this.$container=b?$(b):e,this.$container.on("mouseenter.nav",this.area_selector,function(){$(this).is(f.phantom_selector)||f.current(this,"mouseenter")}),d=this.$container.find("[data-nav_type]"),this.$container.attr("data-nav_type")&&(d=d.add(this.$container)),d.each(function(){var a=$(this),b=a.attr("data-nav_type");a.removeAttr("data-nav_type");var c=a.attr("data-nav_loop");f.siblingsTypeNav(a,b,c)}),e.bind("keydown.navigation",a).bind("nav_key:enter.navigation",g),c||(c=this.$container.find(this.area_selector).filter(":visible")[0]),this.current(c),this},siblingsTypeNav:function(a,b,c){var e=this;a.on("nav_key:left nav_key:right nav_key:up nav_key:down",this.area_selector,function(f){var g,h="last",i=e.current();if("hbox"==b&&"left"==f.keyName||"vbox"==b&&"up"==f.keyName?g="prev":("hbox"==b&&"right"==f.keyName||"vbox"==b&&"down"==f.keyName)&&(g="next"),"next"==g&&(h="first"),g){for(var j=i[g](e.area_selector);j.length&&!j.is(":visible");)j=j[g](e.area_selector);if(!j.length&&c&&(j=a.find(e.area_selector).filter(":visible")[h]()),j.length)return d.current(j),!1}})},off:function(){return j&&j.removeClass(this.higlight_class).trigger("nav_blur"),this.$container&&this.$container.off("mouseenter.nav").off(".loop"),e.unbind(".navigation"),j=null,this},findSome:function(){var a;return j&&j.is(":visible")||(a=this.$container.find(this.area_selector).filter(":visible").eq(0),this.current(a)),this},findNav:function(a,b,c){function d(a,b,c){var d=null;switch(c){case"left":case"right":if(a.top>b.top&&(d=b,b=a,a=d),a.bottom>b.top)return a.top>b.right?b.top-a.right:b.height;break;case"up":case"down":if(a.left>b.left&&(d=b,b=a,a=d),a.right>b.left)return a.left>b.right?b.left-a.right:b.width}return!1}var e=this.checkUserDefined(a,b);if(e)return e;var f,g,h,i,j=a[0].getBoundingClientRect(),k=[],l=null;for(h=0,i=c.length;i>h;h++)if(l=c[h].getBoundingClientRect(),l.left!=j.left||l.top!=j.top){switch(b){case"left":f=j.left>l.left;break;case"right":f=j.right<l.right;break;case"up":f=j.top>l.top;break;case"down":f=j.bottom<l.bottom}f&&k.push({obj:c[h],bounds:l})}var m=9999999,n=9999999,o=9999999,p=0,q=0,r=0,s=0,t=!1,u=!1;for(h=0,i=k.length;i>h;h++)if(this.checkEntryPoint(k[h].obj,b)){var v=k[h].bounds,w=d(j,v,b);if(q=Math.abs(v.top-j.top),r=Math.abs(v.left-j.left),s=Math.sqrt(q*q+r*r),!t||w)if(!w||t){switch(b){case"left":case"right":g=t?n>r||r==n&&m>q:m>q||q==m&&n>r;break;case"up":case"down":g=t?m>q||q==m&&n>r:n>r||r==n&&m>q}g&&(m=q,n=r,o=s,u=k[h].obj)}else m=q,n=r,p=w,u=k[h].obj,t=!0}return u},checkUserDefined:function(a,b){var c=a.attr("data-nav_ud"),d=!1,e=a.attr("data-nav_ud_"+b);if(!c||!e)return!1;if(!e){var f=c.split(","),g=["up","right","left","bottom"];a.attr({"data-nav_ud_up":f[0],"data-nav_ud_right":f[1],"data-nav_ud_down":f[2],"data-nav_ud_left":f[3]}),e=f[g.indexOf(b)]}return"none"==e?d="none":e&&(d=$(e).first()),d},checkEntryPoint:function(a,c){var d=$(a),e=d.attr("data-nav_ep"),f=null;if(!e)return!0;if(f=d.attr("data-nav_ep_"+c),f===b){var g=e.split(",");d.attr("data-nav_ep_top",g[0]),d.attr("data-nav_ep_right",g[1]),d.attr("data-nav_ep_bottom",g[2]),d.attr("data-nav_ep_left",g[3]),f=d.attr("data-nav_ep_"+c)}return!!parseInt(f)}}}var d,e=null;d=a.$$nav=new c,$(function(){$("body").bind("nav_key:left nav_key:right nav_key:up nav_key:down",function(a){var b,c,e=d.current();b=d.$container.find(d.area_selector).filter(":visible"),c=d.findNav(e,a.keyName,b),c&&d.current(c)})})}(this),function(a){var b,c,d,e=0,f=function(a){a._state="play",b=setInterval(function(){a.trigger("update"),a.videoInfo.currentTime+=.5,a.videoInfo.currentTime>=a.videoInfo.duration&&(a.stop(),a.trigger("complete"))},500)},g=a.Player={init:function(){},_state:"stop",play:function(a){this.stop(),this._state="play",this._play(a)},_play:function(){var a=this;setTimeout(function(){a.trigger("ready"),setTimeout(function(){a.trigger("bufferingBegin"),setTimeout(function(){a.videoInfo.currentTime=0,a.trigger("bufferingEnd"),f(a)},1e3)},1e3)},1e3)},stop:function(a){"stop"!=this._state&&(this._stop(),a||this.trigger("stop")),this._state="stop"},pause:function(){this._stop(),this._state="pause"},resume:function(){f(this)},togglePause:function(){"play"==this._state?this.pause():this.resume()},_stop:function(){clearInterval(b)},formatTime:function(a){var b=Math.floor(a/3600),c=a%3600,d=Math.floor(c/60),e=c%60,a=Math.ceil(e);return 10>a&&(a="0"+a),10>d&&(d="0"+d),(b?b+":":"")+d+":"+a},videoInfo:{duration:31,width:640,height:360,currentTime:0},autoInit:!1,seek:function(a){var b=this;b.videoInfo.currentTime=a,b.pause(),b.trigger("bufferingBegin"),setTimeout(function(){b.trigger("bufferingEnd"),b.resume()},500)},audio:{set:function(a){e=a},get:function(){for(var a=2,b=[],c=0;a>c;c++)b.push(0);return b},cur:function(){return e}}};a._&&_.extend?c=_.extend:a.$&&$.extend&&(c=$.extend),a.EventEmitter?d=EventEmitter.prototype:a.Backbone?d=Backbone.Events:a.Events&&(d=Events.prototype),g.extend=function(a){c(this,a)},g.extend(d),$(function(){g.autoInit&&$("body").on("load",function(){g.init()})})}(this),function(a){"use strict";function b(b){var c=[];return b.each(function(){var b=a(this),d=b.attr("data-voice"),e=b.attr("data-voice-group"),f="true"===b.attr("data-voice-hidden")?!0:!1,g=b.attr("data-voice-weight")||0,h=!1;return d?void(b.attr("data-voice-disabled")||(g||(e||f?g=m.candidateWeight:(g=m.helpbarItemWeight,h=!0)),c.push({itemText:d,weight:g,group:e,hidden:f,main:h}),n[d.toLowerCase()]=b)):void console.error("command in ",this," is not defined")}),c}var c,d,e,f,g,h=!1,i=!1,j=[],k=a("<div/>"),l=!1,m={selector:".voicelink",moreText:"More",eventName:"voice",useHidden:!1,helpText:"",showHelperTimes:3,helpbarMaxItems:6,sortByWeight:!0,helpbarItemWeight:200,candidateWeight:0};window.$$voice={voiceTimeout:1e4,_resetVisibilityTimeout:function(){$$voice.helpbarVisible=!0,clearTimeout(g),g=setTimeout(function(){"function"==typeof voiceServer&&(voiceServer=!1,a.voice.restore()),f.hide(),$$voice.helpbarVisible=!1},this.voiceTimeout)},_init:function(){},_nativeCheckSupport:function(){},helpbarVisible:!1,enabled:function(){return i},_setVoiceHelp:function(){},pause:function(){l=!0},resume:function(){l=!1},say:function(b){if(!l){var c=b.toLowerCase(),f=a.extend({},m,d);n[c]&&n[c].trigger(f.eventName),e&&r.call(e,d)}},_nativeTurnOff:function(){},hide:function(){return this._nativeTurnOff(),f.hide(),this},setup:function(b){return a.extend(m,b),this},save:function(){return c&&j.push(c),this},restore:function(){var b=j.pop();return b&&a.fn.voiceLink.apply(b.self,b.args),this},_nativeFromServer:function(){},fromServer:function(a,b){return h?(this.save(),this._nativeFromServer(a,b),this):this},refresh:function(){return this.save().restore()}};var n,o=!1,p={},q=0,r=function(c){if(!o){o=!0,f.hide().empty();var d,e,g,h,i,j=[],l=[],r=a.extend({},m,c),s=r.helpbarMaxItems,t=this.find(r.selector),u={helpbarType:"HELPBAR_TYPE_VOICE_CUSTOMIZE",bKeepCurrentInfo:"false",helpbarItemsList:{}};if(n={},!c.useHidden){var v=t.filter("[data-voice-force-visible]");t=t.filter(":visible").add(v)}d=r.sortByWeight?_.sortBy(b(t),function(a){return-a.weight}):b(t),i=a.grep(d,function(a){return a.hidden===!0}),h=_.difference(d,i),h.length>s&&(h.splice(s-1,0,{itemText:r.moreText,commandList:[{command:r.moreText}]}),k.unbind().bind(r.eventName,function(){a("body").trigger("showVoiceHelpbar"),$$voice._resetVisibilityTimeout(),f.show()}),n[r.moreText.toLowerCase()]=k),e=h.splice(0,s),g=_.union(i,h),_.each(e,function(a){var b=a.itemText;j.push({itemText:b,commandList:[{command:b}]})}),_.each(g,function(a){var b=a.group,c=a.itemText,d=a.hidden,e=a.main;if(e&&!b&&(b=""),!d){p[b]||(q++,p[b]=q);var g=f.find("#voice_group_body_"+p[b]);g.length?g.append('<div class="voice_help_item">'+c+"</div>"):f.append('<div class="voice_group_head">'+b+'</div><div class="voice_group_body" id="voice_group_body_'+p[b]+'"><div class="voice_help_item">'+c+"</div></div>")}l.push({candidate:a.itemText})}),u.helpbarItemsList=j,l.length&&(u.candidateList=l),$$voice._setVoiceHelp(u)}};a.fn.voiceLink=function(b){if(!h||i){if(!h){if(i=$$voice._nativeCheckSupport(),!i)return;$$voice._init(),f=a("#voice_buble"),h=!0}c={self:this,args:arguments},o=!1,b||(b={}),d=b,e=this,$$voice.helpbarVisible&&r.call(this,d)}}}(jQuery),SB.readyForPlatform("browser",function(){}),!function(a){var b,c=new a.SB.Platform("browser");b={keys:{RIGHT:39,LEFT:37,DOWN:40,UP:38,RETURN:27,EXIT:46,TOOLS:32,FF:33,RW:34,NEXT:107,PREV:109,ENTER:13,RED:65,GREEN:66,YELLOW:67,BLUE:68,CH_UP:221,CH_DOWN:219,N0:48,N1:49,N2:50,N3:51,N4:52,N5:53,N6:54,N7:55,N8:56,N9:57,PRECH:45,SMART:36,PLAY:97,STOP:98,PAUSE:99,SUBT:76,INFO:73,REC:82},detect:function(){return!0},initialise:function(){},getNativeDUID:function(){return this.DUID=-1!=navigator.userAgent.indexOf("Chrome")?"CHROMEISFINETOO":"FIREFOXISBEST",this.DUID},volumeUp:function(){},volumeDown:function(){},getVolume:function(){},setData:function(a,b){localStorage.setItem(a,JSON.stringify(b))},getData:function(a){var b;try{b=JSON.parse(localStorage.getItem(a))}catch(c){}return b},removeData:function(a){localStorage.removeItem(a)}},_(c).extend(b)}(this),function(a){"use strict";SB.readyForPlatform("browser",function(){_.extend($$voice,{_init:function(){this.helpbarVisible=!0,a("body").append('<div id="voice_buble"></div><div id="help_voice_bubble"></div><div class="emul_voice_helpbar_wrap"><div id="emul_voice_helpbar"></div></div>'),a("#emul_voice_helpbar").on("click",".emul_voice_trigger",function(){$$voice.say(this.innerHTML)})},_nativeTurnOff:function(){a("#emul_voice_helpbar").empty()},_nativeFromServer:function(a,b){var c=prompt(a);b(c||"")},_nativeCheckSupport:function(){return!0},_setVoiceHelp:function(b){var c=a("#emul_voice_helpbar");c.empty(),b.helpbarItemsList&&a.each(b.helpbarItemsList,function(b,d){a("<div>",{attr:{"class":"emul_voice_trigger main"},html:d.itemText,appendTo:c})}),b.candidateList&&a.each(b.candidateList,function(b,d){a("<div>",{attr:{"class":"emul_voice_trigger"},html:d.candidate,appendTo:c})})}})})}(jQuery),-1!=navigator.userAgent.toLowerCase().indexOf("netcast")&&!function(){var a,b=!1;Player.extend({updateDelay:500,init:function(){var a=this;$("body").append('<object type="video/mp4" data="" width="1280" height="720" id="pluginPlayer" style="z-index: 1; position: absolute; left: 0; top: 0;"></object>'),this.plugin=$("#pluginPlayer")[0],this.$plugin=$(this.plugin),this.plugin.onPlayStateChange=function(){a.onEvent.apply(a,arguments)},this.plugin.onBuffering=function(){a.onBuffering.apply(a,arguments)}},_update:function(){var a=this.plugin.mediaPlayInfo();a&&!b&&(b=!0,this.trigger("ready"),this.videoInfo={duration:a.duration/1e3}),this.trigger("update")},onBuffering:function(a){this.trigger(a?"bufferingBegin":"bufferingEnd")},_play:function(c){clearInterval(a),a=setInterval(function(){Player._update()},this.updateDelay),b=!1,this.plugin.data=c.url,this.plugin.play(1)},_stop:function(){this.plugin.stop()}})}(),SB.readyForPlatform("philips",function(){function a(){switch($("#log").append("<div>"+b.playState+"</div>"),b.playTime>1&&(d||(Player.videoInfo.duration=b.playTime/1e3+1,Player.trigger("ready"),d=!0)),b.playState){case 5:Player.trigger("complete"),f(),Player._state="stop";break;case 0:Player._state="stop";break;case 6:Player.trigger("error");break;case 1:Player.trigger("bufferingEnd"),e();break;case 2:case 3:case 4:Player.trigger("bufferingBegin"),f()}}var b,c,d=!1,e=function(){c=setInterval(function(){var a=0;b.playPosition!=a&&(Player.videoInfo.currentTime=b.playPosition/1e3,Player.trigger("update")),a=b.playPosition},500)},f=function(){clearInterval(c)};Player.extend({init:function(){$("body").append('<div id="mediaobject" style="position:absolute;left:0px;top:0px;width:640px;height:480px;">\n              <object id="videoPhilips" type="video/mpeg4" width="1280" height="720" />\n               </div>'),b=document.getElementById("videoPhilips"),b.onPlayStateChange=a},_play:function(a){b.data=a.url,b.play(1),d=!1,Player.trigger("bufferingBegin")},_stop:function(){b.stop(),f()},pause:function(){b.play(0),this._state="pause",f()},resume:function(){b.play(1),this._state="play",e()},seek:function(a){b.seek(1e3*(a-10))}})}),!function(a){var b,c=new a.SB.Platform("philips");b={externalJs:[],$plugins:{},detect:function(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("nettv")},initialise:function(){},getNativeDUID:function(){},getMac:function(){},getSDI:function(){},setPlugins:function(){this.setKeys()},volumeEnable:function(){},setKeys:function(){this.keys={ENTER:VK_ENTER,PAUSE:VK_PAUSE,LEFT:VK_LEFT,UP:VK_UP,RIGHT:VK_RIGHT,DOWN:VK_DOWN,N0:VK_0,N1:VK_1,N2:VK_2,N3:VK_3,N4:VK_4,N5:VK_5,N6:VK_6,N7:VK_7,N8:VK_8,N9:VK_9,RED:VK_RED,GREEN:VK_GREEN,YELLOW:VK_YELLOW,BLUE:VK_BLUE,RW:VK_REWIND,STOP:VK_STOP,PLAY:VK_PLAY,FF:VK_FAST_FWD,RETURN:VK_BACK,CH_UP:VK_PAGE_UP,CH_DOWN:VK_PAGE_DOWN}}},_.extend(c,b)}(this),function(){var a,b,c,d,e=window.localStorage;if(_.isFunction(window.FileSystem)){if(a=new FileSystem,b=a.isValidCommonPath(curWidget.id),b||a.createCommonDir(curWidget.id),c=curWidget.id+"_localStorage.db",d=a.openCommonFile(c,"r+"))try{JSON.parse(d.readAll())}catch(f){e&&e.clear()}else d=a.openCommonFile(c,"w"),d.writeAll("{}");if(a.closeCommonFile(d),!e){var g={},h=!1,i=_.debounce(function(){h&&(d=a.openCommonFile(c,"w"),d.writeAll(JSON.stringify(window.localStorage)),a.closeCommonFile(d),h=!1)},100);g.setItem=function(a,b){return h=!0,this[a]=b,i(),this[a]},g.getItem=function(a){return this[a]
},g.removeItem=function(a){delete this[a],i()},g.clear=function(){var a=this;for(var b in a)"function"!=typeof a[b]&&delete a[b];i()},window.localStorage=g}}}(),-1!=navigator.userAgent.toLowerCase().indexOf("maple")&&!function(){var a=0,b=function(a,b,c){try{switch(c.length){case 0:return a[b]();case 1:return a[b](c[0]);case 2:return a[b](c[0],c[1]);case 3:return a[b](c[0],c[1],c[2]);case 4:return a[b](c[0],c[1],c[2],c[3]);case 5:return a[b](c[0],c[1],c[2],c[3],c[4]);case 6:return a[b](c[0],c[1],c[2],c[3],c[4],c[5]);case 7:return a[b](c[0],c[1],c[2],c[3],c[4],c[5],c[6]);case 8:return a[b](c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7])}}catch(d){throw d}};Player.extend({usePlayerObject:!1,init:function(){var a=this;if(a.usePlayerObject?(a.plugin=document.getElementById("pluginPlayer"),$("body").append(a.$plugin)):a.plugin=sf.core.sefplugin("Player"),!a.plugin)throw new Error("failed to set plugin");a.plugin.OnStreamInfoReady="Player.OnStreamInfoReady",a.plugin.OnRenderingComplete="Player.OnRenderingComplete",a.plugin.OnCurrentPlayTime="Player.OnCurrentPlayTime",a.plugin.OnCurrentPlaybackTime="Player.OnCurrentPlayTime",a.plugin.OnBufferingStart="Player.OnBufferingStart",a.plugin.OnBufferingComplete="Player.OnBufferingComplete",a.plugin.OnEvent="Player.onEvent"},seek:function(a){0>=a&&(a=0);var b=Math.floor(a-this.videoInfo.currentTime-1);this.videoInfo.currentTime=a,alert("jump: "+b),0>b?this.doPlugin("JumpBackward",-b):this.doPlugin("JumpForward",b)},onEvent:function(a,b){switch(a){case 9:this.OnStreamInfoReady();break;case 4:break;case 8:this.OnRenderingComplete();break;case 14:this.OnCurrentPlayTime(b);break;case 13:break;case 12:this.OnBufferingComplete();break;case 11:this.OnBufferingStart()}},OnRenderingComplete:function(){alert("PLAYER COMPLETE"),Player.trigger("complete")},OnStreamInfoReady:function(){var a,b,c,d;try{a=this.doPlugin("GetDuration")}catch(e){alert("######## "+e.message)}if(a=Math.ceil(a/1e3),this.usePlayerObject)b=this.doPlugin("GetVideoWidth"),c=this.doPlugin("GetVideoHeight");else if(d=this.doPlugin("GetVideoResolution"),-1==d)b=0,c=0;else{var f=d.split("|");b=f[0],c=f[1]}this.videoInfo.duration=a,this.videoInfo.width=1*b,this.videoInfo.height=1*c,this.trigger("ready")},OnBufferingStart:function(){this.trigger("bufferingBegin")},OnBufferingComplete:function(){this.trigger("bufferingEnd")},OnCurrentPlayTime:function(a){"play"==this._state&&(alert(a/1e3),this.videoInfo.currentTime=a/1e3,this.trigger("update"))},_play:function(a){var b=a.url;switch(a.type){case"hls":b+="|COMPONENT=HLS"}this.doPlugin("InitPlayer",b),this.doPlugin("StartPlayback",a.from||0)},_stop:function(){this.doPlugin("Stop")},doPlugin:function(){var a,c=this.plugin,d=arguments[0],e=Array.prototype.slice.call(arguments,1,arguments.length)||[];return this.usePlayerObject?a=b(c,d,e):(-1!=d.indexOf("Buffer")&&(d+="Size"),e.unshift(d),a=b(c,"Execute",e)),a},audio:{set:function(b){Player.doPlugin("SetStreamID",1,b),a=b},get:function(){for(var a=Player.doPlugin("GetTotalNumOfStreamID",1),b=[],c=0;a>c;c++)b.push(Player.doPlugin("GetStreamLanguageInfo",1,c));return b},cur:function(){return a}}})}(),!function(a){var b,c=new a.SB.Platform("samsung"),d={audio:"SAMSUNG-INFOLINK-AUDIO",pluginObjectTV:"SAMSUNG-INFOLINK-TV",pluginObjectTVMW:"SAMSUNG-INFOLINK-TVMW",pluginObjectNetwork:"SAMSUNG-INFOLINK-NETWORK",pluginObjectNNavi:"SAMSUNG-INFOLINK-NNAVI"},e=["$MANAGER_WIDGET/Common/af/../webapi/1.0/deviceapis.js","$MANAGER_WIDGET/Common/af/../webapi/1.0/serviceapis.js","$MANAGER_WIDGET/Common/af/2.0.0/extlib/jquery.tmpl.js","$MANAGER_WIDGET/Common/Define.js","$MANAGER_WIDGET/Common/af/2.0.0/sf.min.js","$MANAGER_WIDGET/Common/API/Widget.js","$MANAGER_WIDGET/Common/API/TVKeyValue.js","$MANAGER_WIDGET/Common/API/Plugin.js","src/platforms/samsung/localstorage.js"],f=!1;if(f=navigator.userAgent.search(/Maple/)>-1){for(var g="",h=0;h<e.length;h++)g+='<script type="text/javascript" src="'+e[h]+'"></script>';for(var i in d)g+="<object id="+i+' border=0 classid="clsid:'+d[i]+'" style="opacity:0.0;background-color:#000000;width:0px;height:0px;"></object>';document.write(g)}b={keys:{},externalJs:[],$plugins:{},detect:function(){return f},initialise:function(){},getNativeDUID:function(){return this.$plugins.pluginObjectNNavi.GetDUID(this.getMac())},getMac:function(){return this.$plugins.pluginObjectNetwork.GetMAC()},getSDI:function(){return this.SDI=this.SDIPlugin.Execute("GetSDI_ID"),this.SDI},getHardwareVersion:function(){var a=this.firmware.match(/\d{4}/)||[];return this.hardwareVersion="2013"===a[0]?sf.core.sefplugin("Device").Execute("Firmware"):null,this.hardwareVersion},setPlugins:function(){var a,b=this;_.each(d,function(a,c){b.$plugins[c]=document.getElementById(c)}),this.$plugins.SDIPlugin=sf.core.sefplugin("ExternalWidgetInterface"),this.$plugins.tvKey=new Common.API.TVKeyValue;var c=this.$plugins.pluginObjectNNavi,e=this.$plugins.pluginObjectTV;this.modelCode=c.GetModelCode(),this.firmware=c.GetFirmware(),this.systemVersion=c.GetSystemVersion(0),this.productCode=e.GetProductCode(1),this.pluginAPI=new Common.API.Plugin,this.widgetAPI=new Common.API.Widget,this.productType=e.GetProductType(),a=new Common.API.TVKeyValue,this.setKeys(),this.pluginAPI.unregistKey(a.KEY_VOL_UP),this.pluginAPI.unregistKey(a.KEY_VOL_DOWN),this.pluginAPI.unregistKey(a.KEY_MUTE),this.widgetAPI.sendReadyEvent(),this.volumeEnable(),c.SetBannerState(2)},volumeEnable:function(){sf.service.setVolumeControl(!0)},setKeys:function(){this.keys=sf.key,document.body.onkeydown=function(a){var b=a.keyCode;switch(b){case sf.key.RETURN:case sf.key.EXIT:case 147:case 261:sf.key.preventDefault()}}},enableScreenSaver:function(a){a=a||!1,sf.service.setScreenSaver(!0,a)},disableScreenSaver:function(){sf.service.setScreenSaver(!1)},exit:function(){sf.core.exit(!1)},blockNavigation:function(){sf.key.preventDefault()}},_.extend(c,b)}(this),function(a){"use strict";SB.readyForPlatform("samsung",function(){var b,c=function(a){switch(a.eventtype){case"EVENT_VOICE_END_MONITOR":break;case"EVENT_VOICE_BEGIN_MONITOR":case"EVENT_VOICE_BTSOUND_START":$$voice.refresh(),$$voice._resetVisibilityTimeout();break;case"EVENT_VOICE_RECOG_RESULT":var c=a.result.toLowerCase();"function"!=typeof b?$$voice.say(c):(b(c),b=!1,$$voice.restore())}};_.extend($$voice,{_init:function(){deviceapis.recognition.SubscribeExEvent(deviceapis.recognition.PL_RECOGNITION_TYPE_VOICE,"Smartbox",function(a){c(a)}),deviceapis.recognition.SetVoiceTimeout(this.voiceTimeout),a("body").append('<div id="voice_buble"></div><div id="help_voice_bubble"></div>')},_nativeCheckSupport:function(){var a=!1;try{a=deviceapis.recognition.IsRecognitionSupported()}catch(b){}return a},_nativeFromServer:function(a,c){b=c;var d={helpbarType:"HELPBAR_TYPE_VOICE_SERVER_GUIDE_RETURN",guideText:a};deviceapis.recognition.SetVoiceHelpbarInfo(JSON.stringify(d))},_setVoiceHelp:function(a){deviceapis.recognition.SetVoiceHelpbarInfo(JSON.stringify(a))},_nativeTurnOff:function(){deviceapis.recognition.SetVoiceHelpbarInfo(JSON.stringify({helpbarType:"HELPBAR_TYPE_VOICE_CUSTOMIZE",bKeepCurrentInfo:"false",helpbarItemsList:[]}))}})})}(jQuery);